!function(){var e={},t=function(t){for(var n=e[t],i=n.deps,r=n.defn,o=i.length,a=new Array(o),u=0;u<o;++u)a[u]=l(i[u]);var c=r.apply(null,a);if(c===undefined)throw"module ["+t+"] returned undefined";n.instance=c},n=function(t,n,l){if("string"!=typeof t)throw"module id must be a string";if(n===undefined)throw"no dependencies for "+t;if(l===undefined)throw"no definition function for "+t;e[t]={deps:n,defn:l,instance:undefined}},l=function(n){var l=e[n];if(l===undefined)throw"module ["+n+"] was undefined";return l.instance===undefined&&t(n),l.instance},i=function(e,t){for(var n=e.length,i=new Array(n),r=0;r<n;++r)i[r]=l(e[r]);t.apply(null,i)};({}).bolt={module:{api:{define:n,require:i,demand:l}}};var r=n,o=function(e,t){r(e,[],function(){return t})};r("ephox.katamari.api.Cell",[],function(){var e=function(t){var n=t,l=function(){return n};return{get:l,set:function(e){n=e},clone:function(){return e(l())}}};return e}),o("global!tinymce.util.Tools.resolve",tinymce.util.Tools.resolve),r("tinymce.core.PluginManager",["global!tinymce.util.Tools.resolve"],function(e){return e("tinymce.PluginManager")}),r("tinymce.core.util.Tools",["global!tinymce.util.Tools.resolve"],function(e){return e("tinymce.util.Tools")}),r("tinymce.core.html.DomParser",["global!tinymce.util.Tools.resolve"],function(e){return e("tinymce.html.DomParser")}),r("tinymce.core.html.Node",["global!tinymce.util.Tools.resolve"],function(e){return e("tinymce.html.Node")}),r("tinymce.core.html.Serializer",["global!tinymce.util.Tools.resolve"],function(e){return e("tinymce.html.Serializer")}),r("tinymce.plugins.fullpage.api.Settings",[],function(){return{shouldHideInSourceView:function(e){return e.getParam("fullpage_hide_in_source_view")},getDefaultXmlPi:function(e){return e.getParam("fullpage_default_xml_pi")},getDefaultEncoding:function(e){return e.getParam("fullpage_default_encoding")},getDefaultFontFamily:function(e){return e.getParam("fullpage_default_font_family")},getDefaultFontSize:function(e){return e.getParam("fullpage_default_font_size")},getDefaultTextColor:function(e){return e.getParam("fullpage_default_text_color")},getDefaultTitle:function(e){return e.getParam("fullpage_default_title")},getDefaultDocType:function(e){return e.getParam("fullpage_default_doctype","<!DOCTYPE html>")}}}),r("tinymce.plugins.fullpage.core.Parser",["tinymce.core.html.DomParser","tinymce.core.html.Node","tinymce.core.html.Serializer","tinymce.core.util.Tools","tinymce.plugins.fullpage.api.Settings"],function(e,t,n,l,i){var r=function(t){return new e({validate:!1,root_name:"#document"}).parse(t)};return{parseHeader:r,htmlToData:function(e,t){function n(e,t){return e.attr(t)||""}var o,a,u=r(t),c={};return c.fontface=i.getDefaultFontFamily(e),c.fontsize=i.getDefaultFontSize(e),o=u.firstChild,7===o.type&&(c.xml_pi=!0,(a=/encoding="([^"]+)"/.exec(o.value))&&(c.docencoding=a[1])),o=u.getAll("#doctype")[0],o&&(c.doctype="<!DOCTYPE"+o.value+">"),o=u.getAll("title")[0],o&&o.firstChild&&(c.title=o.firstChild.value),l.each(u.getAll("meta"),function(e){var t,n=e.attr("name"),l=e.attr("http-equiv");n?c[n.toLowerCase()]=e.attr("content"):"Content-Type"===l&&(t=/charset\s*=\s*(.*)\s*/gi.exec(e.attr("content")))&&(c.docencoding=t[1])}),o=u.getAll("html")[0],o&&(c.langcode=n(o,"lang")||n(o,"xml:lang")),c.stylesheets=[],l.each(u.getAll("link"),function(e){"stylesheet"===e.attr("rel")&&c.stylesheets.push(e.attr("href"))}),o=u.getAll("body")[0],o&&(c.langdir=n(o,"dir"),c.style=n(o,"style"),c.visited_color=n(o,"vlink"),c.link_color=n(o,"link"),c.active_color=n(o,"alink")),c},dataToHtml:function(e,i,o){function a(e,t,n){e.attr(t,n||undefined)}function u(e){s.firstChild?s.insert(e,s.firstChild):s.append(e)}var c,s,f,d,g,m=e.dom;c=r(o),s=c.getAll("head")[0],s||(d=c.getAll("html")[0],s=new t("head",1),d.firstChild?d.insert(s,d.firstChild,!0):d.append(s)),d=c.firstChild,i.xml_pi?(g='version="1.0"',i.docencoding&&(g+=' encoding="'+i.docencoding+'"'),7!==d.type&&(d=new t("xml",7),c.insert(d,c.firstChild,!0)),d.value=g):d&&7===d.type&&d.remove(),d=c.getAll("#doctype")[0],i.doctype?(d||(d=new t("#doctype",10),i.xml_pi?c.insert(d,c.firstChild):u(d)),d.value=i.doctype.substring(9,i.doctype.length-1)):d&&d.remove(),d=null,l.each(c.getAll("meta"),function(e){"Content-Type"===e.attr("http-equiv")&&(d=e)}),i.docencoding?(d||(d=new t("meta",1),d.attr("http-equiv","Content-Type"),d.shortEnded=!0,u(d)),d.attr("content","text/html; charset="+i.docencoding)):d&&d.remove(),d=c.getAll("title")[0],i.title?(d?d.empty():(d=new t("title",1),u(d)),d.append(new t("#text",3)).value=i.title):d&&d.remove(),l.each("keywords,description,author,copyright,robots".split(","),function(e){var n,l,r=c.getAll("meta"),o=i[e];for(n=0;n<r.length;n++)if(l=r[n],l.attr("name")===e)return void(o?l.attr("content",o):l.remove());o&&(d=new t("meta",1),d.attr("name",e),d.attr("content",o),d.shortEnded=!0,u(d))});var p={};return l.each(c.getAll("link"),function(e){"stylesheet"===e.attr("rel")&&(p[e.attr("href")]=e)}),l.each(i.stylesheets,function(e){p[e]||(d=new t("link",1),d.attr({rel:"stylesheet",text:"text/css",href:e}),d.shortEnded=!0,u(d)),delete p[e]}),l.each(p,function(e){e.remove()}),d=c.getAll("body")[0],d&&(a(d,"dir",i.langdir),a(d,"style",i.style),a(d,"vlink",i.visited_color),a(d,"link",i.link_color),a(d,"alink",i.active_color),m.setAttribs(e.getBody(),{style:i.style,dir:i.dir,vLink:i.visited_color,link:i.link_color,aLink:i.active_color})),d=c.getAll("html")[0],d&&(a(d,"lang",i.langcode),a(d,"xml:lang",i.langcode)),s.firstChild||s.remove(),f=new n({validate:!1,indent:!0,apply_source_formatting:!0,indent_before:"head,html,body,meta,title,script,link,style",indent_after:"head,html,body,meta,title,script,link,style"}).serialize(c),f.substring(0,f.indexOf("</body>"))}}}),r("tinymce.plugins.fullpage.ui.Dialog",["tinymce.core.util.Tools","tinymce.plugins.fullpage.core.Parser"],function(e,t){return{open:function(n,l){var i=t.htmlToData(n,l.get());n.windowManager.open({title:"Document properties",data:i,defaults:{type:"textbox",size:40},body:[{name:"title",label:"Title"},{name:"keywords",label:"Keywords"},{name:"description",label:"Description"},{name:"robots",label:"Robots"},{name:"author",label:"Author"},{name:"docencoding",label:"Encoding"}],onSubmit:function(r){var o=t.dataToHtml(n,e.extend(i,r.data),l.get());l.set(o)}})}}}),r("tinymce.plugins.fullpage.api.Commands",["tinymce.plugins.fullpage.ui.Dialog"],function(e){return{register:function(t,n){t.addCommand("mceFullPageProperties",function(){e.open(t,n)})}}}),r("tinymce.plugins.fullpage.core.Protect",["tinymce.core.util.Tools"],function(e){return{protectHtml:function(t,n){return e.each(t,function(e){n=n.replace(e,function(e){return"<!--mce:protected "+escape(e)+"-->"})}),n},unprotectHtml:function(e){return e.replace(/<!--mce:protected ([\s\S]*?)-->/g,function(e,t){return unescape(t)})}}}),r("tinymce.plugins.fullpage.core.FilterContent",["tinymce.core.util.Tools","tinymce.plugins.fullpage.api.Settings","tinymce.plugins.fullpage.core.Parser","tinymce.plugins.fullpage.core.Protect"],function(e,t,n,l){var i=e.each,r=function(e){return e.replace(/<\/?[A-Z]+/g,function(e){return e.toLowerCase()})},o=function(o,u,c,s){var f,d,g,m,p,y="",h=o.dom;if(!(s.selection||(g=l.protectHtml(o.settings.protect,s.content),"raw"===s.format&&u.get()||s.source_view&&t.shouldHideInSourceView(o)))){0!==g.length||s.source_view||(g=e.trim(u.get())+"\n"+e.trim(g)+"\n"+e.trim(c.get())),g=g.replace(/<(\/?)BODY/gi,"<$1body"),f=g.indexOf("<body"),-1!==f?(f=g.indexOf(">",f),u.set(r(g.substring(0,f+1))),d=g.indexOf("</body",f),-1===d&&(d=g.length),s.content=e.trim(g.substring(f+1,d)),c.set(r(g.substring(d)))):(u.set(a(o)),c.set("\n</body>\n</html>")),m=n.parseHeader(u.get()),i(m.getAll("style"),function(e){e.firstChild&&(y+=e.firstChild.value)}),p=m.getAll("body")[0],p&&h.setAttribs(o.getBody(),{style:p.attr("style")||"",dir:p.attr("dir")||"",vLink:p.attr("vlink")||"",link:p.attr("link")||"",aLink:p.attr("alink")||""}),h.remove("fullpage_styles");var v=o.getDoc().getElementsByTagName("head")[0];y&&(h.add(v,"style",{id:"fullpage_styles"},y),p=h.get("fullpage_styles"),p.styleSheet&&(p.styleSheet.cssText=y));var _={};e.each(v.getElementsByTagName("link"),function(e){"stylesheet"===e.rel&&e.getAttribute("data-mce-fullpage")&&(_[e.href]=e)}),e.each(m.getAll("link"),function(e){var t=e.attr("href");if(!t)return!0;_[t]||"stylesheet"!==e.attr("rel")||h.add(v,"link",{rel:"stylesheet",text:"text/css",href:t,"data-mce-fullpage":"1"}),delete _[t]}),e.each(_,function(e){e.parentNode.removeChild(e)})}},a=function(e){var n,l="",i="";if(t.getDefaultXmlPi(e)){var r=t.getDefaultEncoding(e);l+='<?xml version="1.0" encoding="'+(r||"ISO-8859-1")+'" ?>\n'}return l+=t.getDefaultDocType(e),l+="\n<html>\n<head>\n",(n=t.getDefaultTitle(e))&&(l+="<title>"+n+"</title>\n"),(n=t.getDefaultEncoding(e))&&(l+='<meta http-equiv="Content-Type" content="text/html; charset='+n+'" />\n'),(n=t.getDefaultFontFamily(e))&&(i+="font-family: "+n+";"),(n=t.getDefaultFontSize(e))&&(i+="font-size: "+n+";"),(n=t.getDefaultTextColor(e))&&(i+="color: "+n+";"),l+="</head>\n<body"+(i?' style="'+i+'"':"")+">\n"},u=function(n,i,r,o){o.selection||o.source_view&&t.shouldHideInSourceView(n)||(o.content=l.unprotectHtml(e.trim(i)+"\n"+e.trim(o.content)+"\n"+e.trim(r)))};return{setup:function(e,t,n){e.on("BeforeSetContent",function(l){o(e,t,n,l)}),e.on("GetContent",function(l){u(e,t.get(),n.get(),l)})}}}),r("tinymce.plugins.fullpage.ui.Buttons",[],function(){return{register:function(e){e.addButton("fullpage",{title:"Document properties",cmd:"mceFullPageProperties"}),e.addMenuItem("fullpage",{text:"Document properties",cmd:"mceFullPageProperties",context:"file"})}}}),r("tinymce.plugins.fullpage.Plugin",["ephox.katamari.api.Cell","tinymce.core.PluginManager","tinymce.plugins.fullpage.api.Commands","tinymce.plugins.fullpage.core.FilterContent","tinymce.plugins.fullpage.ui.Buttons"],function(e,t,n,l,i){return t.add("fullpage",function(t){var r=e(""),o=e("");n.register(t,r),i.register(t),l.setup(t,r,o)}),function(){}}),l("tinymce.plugins.fullpage.Plugin")()}();