!function(){var t={},e=function(e){for(var n=t[e],a=n.deps,i=n.defn,o=a.length,l=new Array(o),u=0;u<o;++u)l[u]=r(a[u]);var c=i.apply(null,l);if(c===undefined)throw"module ["+e+"] returned undefined";n.instance=c},n=function(e,n,r){if("string"!=typeof e)throw"module id must be a string";if(n===undefined)throw"no dependencies for "+e;if(r===undefined)throw"no definition function for "+e;t[e]={deps:n,defn:r,instance:undefined}},r=function(n){var r=t[n];if(r===undefined)throw"module ["+n+"] was undefined";return r.instance===undefined&&e(n),r.instance},a=function(t,e){for(var n=t.length,a=new Array(n),i=0;i<n;++i)a[i]=r(t[i]);e.apply(null,a)};({}).bolt={module:{api:{define:n,require:a,demand:r}}};var i=n,o=function(t,e){i(t,[],function(){return e})};i("ephox.katamari.api.Cell",[],function(){var t=function(e){var n=e,r=function(){return n};return{get:r,set:function(t){n=t},clone:function(){return t(r())}}};return t}),o("global!tinymce.util.Tools.resolve",tinymce.util.Tools.resolve),i("tinymce.core.PluginManager",["global!tinymce.util.Tools.resolve"],function(t){return t("tinymce.PluginManager")}),i("tinymce.plugins.textpattern.api.Api",[],function(){return{get:function(t){return{setPatterns:function(e){t.set(e)},getPatterns:function(){return t.get()}}}}}),i("tinymce.plugins.textpattern.api.Settings",[],function(){var t=[{start:"*",end:"*",format:"italic"},{start:"**",end:"**",format:"bold"},{start:"***",end:"***",format:["bold","italic"]},{start:"#",format:"h1"},{start:"##",format:"h2"},{start:"###",format:"h3"},{start:"####",format:"h4"},{start:"#####",format:"h5"},{start:"######",format:"h6"},{start:"1. ",cmd:"InsertOrderedList"},{start:"* ",cmd:"InsertUnorderedList"},{start:"- ",cmd:"InsertUnorderedList"}];return{getPatterns:function(e){return e.textpattern_patterns!==undefined?e.textpattern_patterns:t}}}),i("tinymce.core.util.Delay",["global!tinymce.util.Tools.resolve"],function(t){return t("tinymce.util.Delay")}),i("tinymce.core.util.VK",["global!tinymce.util.Tools.resolve"],function(t){return t("tinymce.util.VK")}),o("global!document",document),i("tinymce.core.dom.TreeWalker",["global!tinymce.util.Tools.resolve"],function(t){return t("tinymce.dom.TreeWalker")}),i("tinymce.core.util.Tools",["global!tinymce.util.Tools.resolve"],function(t){return t("tinymce.util.Tools")}),i("tinymce.plugins.textpattern.core.Patterns",[],function(){var t=function(t){return t.sort(function(t,e){return t.start.length>e.start.length?-1:t.start.length<e.start.length?1:0})},e=function(t,e,n,r){return e.substr(n-t.end.length-r,t.end.length)===t.end},n=function(t,e,n){return t-e-n.end.length-n.start.length>0};return{findPattern:function(t,e){for(var n=0;n<t.length;n++)if(0===e.indexOf(t[n].start)&&(!t[n].end||e.lastIndexOf(t[n].end)===e.length-t[n].end.length))return t[n]},findEndPattern:function(r,a,i,o){var l,u,c=t(r);for(u=0;u<c.length;u++)if(l=c[u],l.end!==undefined&&e(l,a,i,o)&&n(i,o,l))return l}}}),i("tinymce.plugins.textpattern.core.Formatter",["global!document","tinymce.core.dom.TreeWalker","tinymce.core.util.Tools","tinymce.plugins.textpattern.core.Patterns"],function(t,e,n,r){var a=function(t,e,n,r){return t=r>0?t.splitText(r):t,t.splitText(n-r+e.end.length),t.deleteData(0,e.start.length),t.deleteData(t.data.length-e.end.length,e.end.length),t},i=function(e,n,a){if(!1!==n.collapsed){var i=n.startContainer,o=i.data,l=!0===a?1:0;if(3===i.nodeType){var u=r.findEndPattern(e,o,n.startOffset,l);if(u!==undefined){var c=o.lastIndexOf(u.end,n.startOffset-l),f=o.lastIndexOf(u.start,c-u.end.length);if(c=o.indexOf(u.end,f+u.start.length),-1!==f){var d=t.createRange();d.setStart(i,f),d.setEnd(i,c+u.end.length);var s=r.findPattern(e,d.toString());if(!(u===undefined||s!==u||i.data.length<=u.start.length+u.end.length))return{pattern:u,startOffset:f,endOffset:c}}}}}},o=function(t,e,r,i){var o=n.isArray(r.pattern.format)?r.pattern.format:[r.pattern.format];if(0!==n.grep(o,function(e){var n=t.formatter.get(e);return n&&n[0].inline}).length)return t.undoManager.transact(function(){e=a(e,r.pattern,r.endOffset,r.startOffset,i),o.forEach(function(n){t.formatter.apply(n,{},e)})}),e},l=function(t,e,n){var r=t.selection.getRng(!0),a=i(e,r,n);if(a)return o(t,r.startContainer,a,n)};return{patternFromRng:i,applyInlineFormatSpace:function(t,e){return l(t,e,!0)},applyInlineFormatEnter:function(t,e){return l(t,e,!1)},applyBlockFormat:function(t,a){var i,o,l,u,c,f,d,s,g,m,p;if(i=t.selection,o=t.dom,i.isCollapsed()&&(d=o.getParent(i.getStart(),"p"))){for(g=new e(d,d);c=g.next();)if(3===c.nodeType){u=c;break}if(u){if(!(s=r.findPattern(a,u.data)))return;if(m=i.getRng(!0),l=m.startContainer,p=m.startOffset,u===l&&(p=Math.max(0,p-s.start.length)),n.trim(u.data).length===s.start.length)return;s.format&&(f=t.formatter.get(s.format))&&f[0].block&&(u.deleteData(0,s.start.length),t.formatter.apply(s.format,{},u),m.setStart(l,p),m.collapse(!0),i.setRng(m)),s.cmd&&t.undoManager.transact(function(){u.deleteData(0,s.start.length),t.execCommand(s.cmd)})}}}}}),i("tinymce.plugins.textpattern.core.KeyHandler",["tinymce.core.util.VK","tinymce.plugins.textpattern.core.Formatter"],function(t,e){function n(t,n){var r,a;r=e.applyInlineFormatEnter(t,n),r&&(a=t.dom.createRng(),a.setStart(r,r.data.length),a.setEnd(r,r.data.length),t.selection.setRng(a)),e.applyBlockFormat(t,n)}function r(t,n){var r,a,i,o,l;(r=e.applyInlineFormatSpace(t,n))&&(l=t.dom,a=r.data.slice(-1),/[\u00a0 ]/.test(a)&&(r.deleteData(r.data.length-1,1),i=l.doc.createTextNode(a),l.insertAfter(i,r.parentNode),o=l.createRng(),o.setStart(i,1),o.setEnd(i,1),t.selection.setRng(o)))}var a=function(t,e,n){for(var r=0;r<t.length;r++)if(n(t[r],e))return!0},i=function(e,n){return a(e,n,function(e,n){return e===n.keyCode&&!1===t.modifierPressed(n)})};return{handleEnter:n,handleInlineKey:r,checkCharCode:function(t,e){return a(t,e,function(t,e){return t.charCodeAt(0)===e.charCode})},checkKeyCode:i}}),i("tinymce.plugins.textpattern.core.Keyboard",["tinymce.core.util.Delay","tinymce.core.util.VK","tinymce.plugins.textpattern.core.KeyHandler"],function(t,e,n){return{setup:function(r,a){var i=[",",".",";",":","!","?"],o=[32];r.on("keydown",function(t){13!==t.keyCode||e.modifierPressed(t)||n.handleEnter(r,a.get())},!0),r.on("keyup",function(t){n.checkKeyCode(o,t)&&n.handleInlineKey(r,a.get())}),r.on("keypress",function(e){n.checkCharCode(i,e)&&t.setEditorTimeout(r,function(){n.handleInlineKey(r,a.get())})})}}}),i("tinymce.plugins.textpattern.Plugin",["ephox.katamari.api.Cell","tinymce.core.PluginManager","tinymce.plugins.textpattern.api.Api","tinymce.plugins.textpattern.api.Settings","tinymce.plugins.textpattern.core.Keyboard"],function(t,e,n,r,a){return e.add("textpattern",function(e){var i=t(r.getPatterns(e.settings));return a.setup(e,i),n.get(i)}),function(){}}),r("tinymce.plugins.textpattern.Plugin")()}();